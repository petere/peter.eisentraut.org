<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: pg_dump | Peter Eisentraut]]></title>
  <link href="http://peter.eisentraut.org/blog/categories/pg-dump/atom.xml" rel="self"/>
  <link href="http://peter.eisentraut.org/"/>
  <updated>2016-07-20T12:31:39-04:00</updated>
  <id>http://peter.eisentraut.org/</id>
  <author>
    <name><![CDATA[Peter Eisentraut]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Check your pg_dump compression levels]]></title>
    <link href="http://peter.eisentraut.org/blog/2015/12/07/check-your-pg-dump-compression-levels"/>
    <updated>2015-12-07T20:00:00-05:00</updated>
    <id>http://peter.eisentraut.org/blog/2015/12/07/check-your-pg-dump-compression-levels</id>
    <content type="html"><![CDATA[<p>I was idly wondering what was taking <code>pg_dump</code> so long and noticed
that it always seemed to be pegged at 100% CPU usage on the client.
That was surprising because naively one might think that the
bottleneck are the server&rsquo;s or the client&rsquo;s disk or the network.
Profiling quickly revealed that the compression library zlib was
taking most of the run time on the client.  And indeed, turning
compression off caused <code>pg_dump</code> to fly without getting anywhere near
100% CPU.</p>

<p>When using the custom output format in <code>pg_dump</code> (<code>-Fc</code>), the output
is automatically compressed, using the same default level that <code>gzip</code>
uses.  By using the option <code>-Z</code>, one can select a compression level
between 0 (off) and 9 (highest).  Although it is not documented, the
default corresponds to level 6.</p>

<p>Some simple testing has shown that lowering the level from 6 to 1 can
speed up the dump run time by a factor of 3 or more while only
increasing the output size by 10%.  Even the levels in between give
significant speed increases with only minimal differences in output
size.  On the other hand, increasing the compression level to 9 only
decreases the output size by about 1% while causing slow downs by a
factor of 2.  (In this test, level 1 was about twice as slow as no
compression, but the output size was about 40% of the uncompressed
size.  So using at least some compression was still desirable.)</p>

<p>I encourage experimentation with these numbers.  I might actually
default my scripts to <code>-Z1</code> in the future.</p>
]]></content>
  </entry>
  
</feed>
